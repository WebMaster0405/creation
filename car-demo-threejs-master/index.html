<!DOCTYPE html>
<html lang="en">
<head>
    <title>Car Racing</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style type="text/css">
        body {
            margin: 0px;
            overflow: hidden;
        }
    </style>
</head>
<body>

<script src="js/three.min.js"></script>
<script src="js/ColladaLoader.js"></script>

<script>
    /* GLOBAL VARIABLES */
    var camera;
    var scene;
    var renderer;
    var geometry;
    var material;
    var mesh;
    var car;
    var skin;
    var car_s1 = false;
    var car_s2 = false;
    var car_s3 = false;
    var car_s4 = false;

    var screenW = window.innerWidth;
var screenH = window.innerHeight; /*SCREEN*/
var spdx = 0, spdy = 0; mouseX = 0, mouseY = 0, mouseDown = false; /*MOUSE*/
    document.addEventListener('mousemove', function(event) {
        mouseX = event.clientX;
        mouseY = event.clientY;
    }, false);
    document.body.addEventListener("mousedown", function(event) {
        mouseDown = true
    }, false);
    document.body.addEventListener("mouseup", function(event) {
        mouseDown = false
    }, false);
    function animate() {    
        spdy =  (screenH / 2 - mouseY) / 40;
        spdx =  (screenW / 2 - mouseX) / 40;
        if (mouseDown){
            mesh.rotation.x = spdy;
            mesh.rotation.y = spdx;
        }
    }
    
    var loader = new THREE.ColladaLoader();
    loader.options.convertUpAxis = true;
    loader.load('./car.dae', function(collada) {

        car = collada.scene;
        skin = collada.skins[0];

        car.scale.x = car.scale.y = car.scale.z = 3;
        car.updateMatrix();

        init();
        render();
    });

    function init() {
        scene = new THREE.Scene();

        addCamera();

        addFloor();

        addSkyBox();

        addLight();

        addBuildings();

        scene.add(car);

        car.position.x = 3722;
        car.position.y = 0;

        renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);

        document.body.appendChild(renderer.domElement);
    }

    function addCamera() {
        camera = new THREE.PerspectiveCamera(75, window.innerWidth
                / window.innerHeight, 0.1, 100000);
        camera.position.X = 1000;
        camera.position.y = 10000;
        camera.position.z = 20000;
        camera.lookAt(new THREE.Vector3(0, 0, 0));
        // scene.add(mesh);

    }

    function addLight() {
        pointLight = new THREE.PointLight(0xffffff);
        pointLight.position = new THREE.Vector3(0, 10000, 0);
        scene.add(pointLight);
    }

    function addFloor() {
        var floorTexture = new THREE.ImageUtils.loadTexture( 'images/sand3.jpg' );
        floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
        floorTexture.repeat.set( 1, 1 );
        var floorMaterial = new THREE.MeshBasicMaterial( { map: floorTexture, side: THREE.DoubleSide } );
        var floorGeometry = new THREE.PlaneGeometry(100000, 100000, 100, 100);
        var floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.position.y = -0.5;
        floor.rotation.x = Math.PI / 2;
        scene.add(floor);
    }

    function addSkyBox() {
        var imagePrefix = "images/sky";
        var directions  = ["+x", "-x", "+y", "-y", "+z", "-z"];
        var imageSuffix = ".png";
        var skyGeometry = new THREE.CubeGeometry( 100000, 100000, 100000 );

        var materialArray = [];
        for (var i = 0; i < 6; i++)
            materialArray.push( new THREE.MeshBasicMaterial({
                map: THREE.ImageUtils.loadTexture( imagePrefix + directions[i] + imageSuffix ),
                side: THREE.BackSide
            }));
        var skyMaterial = new THREE.MeshFaceMaterial( materialArray );
        var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
        scene.add( skyBox );
    }

    function addBuildings() {
        var geometry = new THREE.CubeGeometry( 3000, 3000, 3000);
        var crateMaterial = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );
        var sandMaterial = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );
        var murMaterial = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );
        var woodMaterial = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );

        var moveZ = 4500;
        var moveY = 1500;
        var moveX = -1200;
        for (var i=0; i<2; i++) {
            var building = new THREE.Mesh(geometry, crateMaterial);
            building.position.z = moveZ;
            building.position.y = moveY;
            building.position.x = moveX;

            moveX += 9000;
            moveY += 00;
            // moveZ += 1000;
            scene.add( building );
        }
        var geometry1 = new THREE.CubeGeometry( 3000, 3000, 3000);
        var crateMaterial1 = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );
        var sandMaterial1 = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );
        var murMaterial1 = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );
        var woodMaterial1 = new THREE.MeshPhongMaterial( { map: THREE.ImageUtils.loadTexture('images/mur.jpg') } );

        var moveZ = 14500;
        var moveY = 1500;
        var moveX = -1200;
        for (var i=0; i<2; i++) {
            var building1 = new THREE.Mesh(geometry1, crateMaterial1);
            building1.position.z = moveZ;
            building1.position.y = moveY;
            building1.position.x = moveX;

            moveX += 9000;
            moveY += 00;
            // moveZ += 1000;
            scene.add( building1 );
        }
        // Using wireframe materials to illustrate shape details.
        var wireframeMaterial = new THREE.MeshBasicMaterial( { color: 0x000000, wireframe: true, transparent: true } );
        var prismMultiMaterial = [ murMaterial, wireframeMaterial ];
        var sandMultiMaterial = [sandMaterial, wireframeMaterial];
        var woodMultiMaterial = [woodMaterial, wireframeMaterial];

        // prism
        // var shape = THREE.SceneUtils.createMultiMaterialObject(
        //         // radiusAtTop, radiusAtBottom, height, segmentsAroundRadius, segmentsAlongHeight,
        //         new THREE.CylinderGeometry( 200, 600, 1500, 10, 10 ),
        //         prismMultiMaterial );
        // shape.position.set(4500, 4500, -1000);
        // scene.add( shape );

        // cone - truncated
        // var shape = THREE.SceneUtils.createMultiMaterialObject(
        //         // radiusAtTop, radiusAtBottom, height, segmentsAroundRadius, segmentsAlongHeight,
        //         new THREE.CylinderGeometry( 500, 800, 1400, 20, 4 ),
        //         woodMultiMaterial );
        // shape.position.set(-4000, 4000, -1000);
        // scene.add( shape );

        // pyramid - truncated
        // var shape = THREE.SceneUtils.createMultiMaterialObject(
        //         // radiusAtTop, radiusAtBottom, height, segmentsAroundRadius, segmentsAlongHeight,
        //         new THREE.CylinderGeometry( 500, 1000, 1300, 6, 4 ),
        //         sandMultiMaterial );
        // shape.position.set(-1000, 5000, -200);
        // scene.add( shape );
    }

    function render() {
        requestAnimationFrame(render);
        // if(car_s = )
        speed = 100;
        // if (keyDown[38]) {
        //     if (speed < 130) {
        //         speed += 1;
        //     }
        // }
        // } else if (keyDown[40]) {
        //     if (speed > 0) speed -= 2;
        //  else {
        //     speed -= 1;
        //     if (speed < 0) speed = 0;
        // }
        // if (speed > 0) {
        //     if (keyDown[37]) car.rotation.y += 0.05;
        //     if (keyDown[39]) car.rotation.y -= 0.05;
        // }

        if(car.position.z >= 8781&&car_s1==false) {
            car.rotation.y += 1.5718999999;
            car_s1=true;            
            car_s2 = false;
        }
        if(car_s3==false&&car.position.z<=-190){
            car.rotation.y += 1.5718999999;
            car_s3=true;
            car_s4=false;
        }
        if(car.position.x <= 3696 && car_s4==false){
            car.rotation.y += 1.5718999999;
            car_s4=true;
            car_s1 =false;
        }
        if(car.position.x >= 12744 &&car_s2==false){
            car.rotation.y += 1.5718999999;
            car_s2 = true;
            car_s3=false;
        }
        console.log(car.position.x+'y'+car.position.z);

        car.position.x += speed * Math.sin(car.rotation.y);
        car.position.z += speed * Math.cos(car.rotation.y);

        // camera.lookAt(car.position);

        renderer.render(scene, camera);
    }

    // speed = 0;
    keyDown = new Array();
    for (i = 0; i < 300; i++) {
        keyDown[i] = false;
    }

    document.onkeydown = function(event) {
        keyDown[event.keyCode] = true;
    }

    document.onkeyup = function(event) {
        keyDown[event.keyCode] = false;
    }
</script>
</body>
</html>